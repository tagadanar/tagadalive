/*
 * AI - Main entry point and utilities for combo search
 *
 * Algorithm selection: set AI.mode in main before calling AI.getCombo()
 * Example: AI.mode = AI.MODE_UNIFIED_MCTS
 *
 * See AI/Algorithms/ for algorithm implementations:
 *   - PTS: Fast greedy target-first
 *   - MCTS: Monte Carlo Tree Search
 *   - BeamSearch: Beam search multi-path
 *   - UnifiedMCTS: Single tree with cells as first-level (recommended)
 *   - Hybrid: Combines PTS with other algorithms
 */
class AI {
	// === Algorithm Modes ===
	static integer MODE_PTS = 0           // Priority Target Simulation (fast, greedy)
	static integer MODE_MCTS = 1          // Monte Carlo Tree Search (thorough, slower)
	static integer MODE_BEAM = 2          // Beam Search (balanced speed/quality)
	static integer MODE_HYBRID = 3        // PTS seeds MCTS at one cell
	static integer MODE_HYBRID_GUIDED = 4 // PTS guides MCTS cell order
	static integer MODE_HYBRID_BEAM = 5   // PTS guides Beam Search cell order
	static integer MODE_UNIFIED_MCTS = 6  // Unified MCTS with cell selection in tree (recommended)

	// Current mode (default value, can be overridden in main)
	static integer mode = AI.MODE_UNIFIED_MCTS

	/*
	 * Get readable name for a mode (for debugging)
	 */
	static string getModeName(integer m) {
		if (m == AI.MODE_PTS) return "PTS"
		if (m == AI.MODE_MCTS) return "MCTS"
		if (m == AI.MODE_BEAM) return "BEAM"
		if (m == AI.MODE_HYBRID) return "HYBRID"
		if (m == AI.MODE_HYBRID_GUIDED) return "HYBRID_GUIDED"
		if (m == AI.MODE_HYBRID_BEAM) return "HYBRID_BEAM"
		if (m == AI.MODE_UNIFIED_MCTS) return "UNIFIED_MCTS"
		return "UNKNOWN"
	}

	/*
	 * Main entry point: get the best combo using the selected algorithm.
	 */
	static Combo getCombo() {
		if (AI.mode == AI.MODE_PTS) {
			Benchmark.setAlgo("PTS", "PTS")
			Combo ptsCombo = PTS.buildCombo()
			Benchmark.setChosen(ptsCombo.getScore()!, count(ptsCombo.actions), "PTS:" + PTS.buildComboDesc(ptsCombo))
			return ptsCombo
		}
		if (AI.mode == AI.MODE_MCTS) {
			Benchmark.setAlgo("MCTS", "MCTS")
			return Hybrid.runMCTSFull()
		}
		if (AI.mode == AI.MODE_BEAM) {
			Benchmark.setAlgo("BEAM", "BEAM")
			return Hybrid.runBeamFull()
		}
		if (AI.mode == AI.MODE_HYBRID) {
			return Hybrid.getMCTSSeeded()
		}
		if (AI.mode == AI.MODE_HYBRID_GUIDED) {
			return Hybrid.getMCTSGuided()
		}
		if (AI.mode == AI.MODE_HYBRID_BEAM) {
			return Hybrid.getBeamGuided()
		}
		// MODE_UNIFIED_MCTS
		return UnifiedMCTS.run()
	}

	/*
	 * Find best end-of-turn position for a combo.
	 * Used by all algorithms after action selection.
	 */
	static Position findBestPosition(Combo combo) {
		Consequences consequences = combo.getCurrentConsequences()
		Cell currentCell = combo.getCurrentCell()
		integer currentMP = combo.getCurrentMP()
		return MapPosition.findBestPosition(currentCell, currentMP, consequences)
	}
}
