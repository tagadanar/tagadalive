/*
 * AI - Main entry point and utilities for combo search
 *
 * Algorithm selection: set AI.mode in main before calling AI.getCombo()
 * Example: AI.mode = AI.MODE_MCTS
 *
 * See AI/Algorithms/ for algorithm implementations:
 *   - MCTS: Monte Carlo Tree Search
 *   - BeamSearch: Beam search multi-path
 *   - Hybrid: Runs MCTS or BeamSearch over all cells
 *   - ComboExplorer: Multi-phase exploration
 */
class AI {
	// === Algorithm Modes ===
	static integer MODE_MCTS = 1            // Monte Carlo Tree Search (thorough, slower)
	static integer MODE_BEAM = 2            // Beam Search (balanced speed/quality)
	static integer MODE_COMBO_EXPLORER = 9   // Multi-phase combo exploration

	// Current mode (default value, can be overridden in main)
	static integer mode = AI.MODE_COMBO_EXPLORER

	/*
	 * Get readable name for a mode (for debugging)
	 */
	static string getModeName(integer m) {
		if (m == AI.MODE_MCTS) return "MCTS"
		if (m == AI.MODE_BEAM) return "BEAM"
		if (m == AI.MODE_COMBO_EXPLORER) return "EXPLORER"
		return "UNKNOWN"
	}

	/*
	 * Main entry point: get the best combo using the selected algorithm.
	 */
	static Combo getCombo() {
		// Bulbs use lightweight greedy search instead of full exploration
		if (Fight.self.isBulb) {
			Benchmark.setAlgo("BULB", "GREEDY")
			return BulbGreedy.getCombo()
		}

		if (AI.mode == AI.MODE_MCTS) {
			Benchmark.setAlgo("MCTS", "MCTS")
			return Hybrid.runMCTSFull()
		}
		if (AI.mode == AI.MODE_BEAM) {
			Benchmark.setAlgo("BEAM", "BEAM")
			return Hybrid.runBeamFull()
		}
		// MODE_COMBO_EXPLORER (default)
		Benchmark.setAlgo("EXPLORER", "EXPLORER")
		Combo combo = ComboExplorer.explore()
		Benchmark.setChosen(combo.getScore()!, count(combo.actions), "EXP:" + combo.describe())
		return combo
	}

	/*
	 * Find best end-of-turn position for a combo.
	 * Used by all algorithms after action selection.
	 */
	static Position findBestPosition(Combo combo) {
		Consequences consequences = combo.getCurrentConsequences()
		Cell currentCell = combo.getCurrentCell()
		integer currentMP = combo.getCurrentMP()
		return MapPosition.findBestPosition(currentCell, currentMP, consequences)
	}
}
