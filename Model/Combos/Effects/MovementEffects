/**
 * MovementEffects - Handlers for movement-related effects
 * 
 * Handles: EFFECT_TELEPORT, EFFECT_INVERT, EFFECT_PUSH, EFFECT_ATTRACT,
 *          EFFECT_REPEL, EFFECT_SUMMON, EFFECT_RESURRECT
 * 
 * NOTE: These effects are currently not scored as they would need
 * position simulation. They are registered as empty handlers to avoid
 * "unhandled effect" warnings.
 * 
 * TODO: Implement position simulation for proper scoring of these effects.
 * See improvement axis #5 in the codebase analysis.
 */

// Register all movement effect handlers (empty - not scored yet)
Consequences.registerHandlers([
	EFFECT_TELEPORT: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Would need: MapPosition.evaluatePositionChange(from, to) for teleport value
	},

	EFFECT_INVERT: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Swaps positions between caster and target
		// Track position changes for pathfinding in subsequent actions:
		// - Our old cell becomes an obstacle (target moves there)
		// - Target's old cell becomes walkable (we move there)
		conseq.addNewObstacle(conseq.currentCell)
		conseq.addFreedCell(entityTarget.cell)
		conseq.currentCell = entityTarget.cell

		// Score from pre-computed candidate (ally damage delta + vulnerability impact)
		// This is the full tactical value of the position swap
		if (conseq.movementCandidate != null) {
			conseq.score += conseq.movementCandidate!.score
		}
	},

	EFFECT_PUSH: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Pushes target away from caster
		// Track target's new position and add score from pre-computed candidate
		if (conseq.movementCandidate != null) {
			conseq.score += conseq.movementCandidate!.score
			// TODO: Track target position change for subsequent action planning
		}
	},

	EFFECT_ATTRACT: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Pulls target toward caster
		// Track target's new position and add score from pre-computed candidate
		if (conseq.movementCandidate != null) {
			conseq.score += conseq.movementCandidate!.score
			// TODO: Track target position change for subsequent action planning
		}
	},

	EFFECT_REPEL: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Repels target away
	},

	EFFECT_SUMMON: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Note: targetCell not directly available in movement context, pass null for base value only
		conseq.score += EffectHandlers.summon(effect.item, entitySource.level, null)
	},

	EFFECT_RESURRECT: (ItemEffect effect, Entity entitySource, Entity entityTarget, real ratioDmg, Consequences conseq) => void {
		// Resurrection is inverse of ally death: +KILL_VALUE
		// Only score if we have a valid resurrection target
		if (Fight.resurrectTargetId != null) {
			conseq.score += ScoringConfig.KILL_VALUE
		}
	}
])
