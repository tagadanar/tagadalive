/*
 * PendingBulb - Tracks a bulb that will be summoned, for accurate buff scoring.
 * Stores all info needed to compute actual damage AND defensive score after each buff.
 */
class PendingBulb {
	BulbStats stats           // Current stats (updated by buffs)
	Entity target             // Who the bulb will attack
	Array<Item> offensiveChips // Bulb's damage chips
	integer bulbType          // Entity.BULB_LIGHTNING, etc.
	real currentDmgScore      // Damage score already applied to Consequences

	constructor(BulbStats stats, Entity target, Array<Item> offensiveChips, integer bulbType, real initialDmgScore) {
		this.stats = stats
		this.target = target
		this.offensiveChips = offensiveChips
		this.bulbType = bulbType
		this.currentDmgScore = initialDmgScore
	}

	PendingBulb clone() {
		return PendingBulb(this.stats.clone(), this.target, this.offensiveChips, this.bulbType, this.currentDmgScore)
	}

	/*
	 * Get coefficient for a stat based on bulb type.
	 * Uses EntityCoefs lookup with fallback to generic ENTITY_BULB.
	 */
	real getCoef(integer stat) {
		Map<integer, real>? coefs = EntityCoefs.baseCoefs[this.bulbType]
		if (coefs == null) {
			coefs = EntityCoefs.baseCoefs[ENTITY_BULB]
		}
		return coefs![stat]!
	}
}
