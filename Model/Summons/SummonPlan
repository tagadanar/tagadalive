/*
 * DefensivePlan - Plan for defensive summon: safe cell + survival buffs
 */
class DefensivePlan {
	Cell spawnCell      // Where to summon the bulb (0-danger cell)
	Cell summonFromCell // Where leek stands to cast summon
	Item summonChip     // The summon chip
	Array<Buff> buffs   // Defensive buffs to cast on bulb
	integer totalTP     // Total TP cost (summon + all buffs)
	real score          // Score based on bulb survival value
	integer danger      // Danger level at spawn cell (0 = safe)
	Combo combo         // The built combo

	constructor(Cell spawnCell, Cell summonFromCell, Item summonChip, Array<Buff> buffs,
	            integer totalTP, real score, integer danger, Combo combo) {
		this.spawnCell = spawnCell
		this.summonFromCell = summonFromCell
		this.summonChip = summonChip
		this.buffs = buffs
		this.totalTP = totalTP
		this.score = score
		this.danger = danger
		this.combo = combo
	}

	string string() {
		string buffStr = ""
		for (Buff b in this.buffs) {
			buffStr += "+" + b.chip.name
		}
		return "<DefPlan c" + this.spawnCell.id + " danger=" + this.danger + " TP=" + this.totalTP +
		       " score=" + round(this.score) + " buffs:" + (buffStr == "" ? "none" : buffStr) + ">"
	}
}

/*
 * OffensivePlan - Complete plan: summon + optional buffs on bulb
 */
class OffensivePlan {
	Cell spawnCell      // Where to summon the bulb
	Cell summonFromCell // Where leek stands to cast summon
	Item summonChip     // The summon chip
	Array<Buff> buffs   // Buffs to cast on bulb after summoning
	integer totalTP     // Total TP cost (summon + all buffs)
	real score          // Final score with buffed bulb damage
	Entity target       // Who the bulb will attack
	real expectedDmg    // Raw damage with buffed stats
	BulbStats buffedStats // Bulb stats after buffs applied
	Combo combo         // The built combo (ready to use by ComboExplorer)

	constructor(Cell spawnCell, Cell summonFromCell, Item summonChip, Array<Buff> buffs,
	            integer totalTP, real score, Entity target, real expectedDmg, BulbStats buffedStats, Combo combo) {
		this.spawnCell = spawnCell
		this.summonFromCell = summonFromCell
		this.summonChip = summonChip
		this.buffs = buffs
		this.totalTP = totalTP
		this.score = score
		this.target = target
		this.expectedDmg = expectedDmg
		this.buffedStats = buffedStats
		this.combo = combo
	}

	string string() {
		string buffStr = ""
		for (Buff b in this.buffs) {
			buffStr += "+" + b.chip.name
		}
		return "<Plan c" + this.spawnCell.id + " TP=" + this.totalTP + " score=" + round(this.score) +
		       " dmg=" + round(this.expectedDmg) + " buffs:" + (buffStr == "" ? "none" : buffStr) + ">"
	}
}
